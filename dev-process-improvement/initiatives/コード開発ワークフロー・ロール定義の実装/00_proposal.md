# 改善施策提案: コード開発ワークフロー・ロール定義の実装

## 背景・課題

「コード開発ワークフロー設計の探索」（Phase 1: 概要設計、Phase 2: 詳細設計）と「シナリオ別セッション運用フロー設計」（5シナリオ、ディスパッチャー、ハイブリッドレビュー）の2施策で設計が完了した。しかし、設計書の内容がロール定義ファイル（実行プロンプト）にまだ反映されていないため、以下の問題が残っている。

- `roles/dev_manager.md` のエントリーポイントが旧設計（外部システム経由）のままで、人間→ディスパッチャー→dev_manager の新アーキテクチャに未対応
- `roles/_base/common.md` に DT-XXX タスクID管理、次段ロール申し送り、セッション間引き継ぎプロトコルが未反映
- 既存7ロールに設計書で特定した20の修正提案が未適用（TDD分離対応、エスカレーション基準の定量化、発動条件の明示など）
- 設計ドキュメント2件に session-operation-flow.md の設計変更（§12.4 の8変更点）が未反映
- ディスパッチャー機能が未実装（人間のエントリーポイントが未整備）

## 目標

3つの設計書（`dev-workflow-overview.md`、`dev-workflow-detail.md`、`session-operation-flow.md`）の設計内容を、ロール定義ファイルとディスパッチャースキルに完全に反映する。

## スコープ
### やること
- `roles/dev_manager.md` の差分更新（エントリーポイント変更、5シナリオ対応、ハイブリッドレビュー参照）
- `roles/_base/common.md` の修正（DT-XXX管理、申し送り、引き継ぎプロトコル、エラー回復参照）
- 既存7ロールへの20修正ポイントの適用（`dev-workflow-detail.md` §5.1）
- 設計ドキュメント2件の更新（`session-flow-advanced.md` §12.4 の8変更点）
- ディスパッチャーの Claude Code スキルとしての新規作成（`.claude/skills/dispatcher/SKILL.md`）

### やらないこと
- テスト実行コマンドの確定（`common.md` の既存 TODO）— 別施策で対応
- 不足ロール（planner, architect, tester, eval_manager）の新設 — 運用の成熟を待って判断
- openspec 統合（ISS-002）— openspec 開発ライフサイクル確定後

## 期待される効果

- 人間がディスパッチャースキルを通じて開発セッションを直接起動可能になる
- 全ロールが設計書の最新仕様に準拠した一貫性のある定義を持つ
- TDD分離判断、エスカレーション基準、発動条件が定量的に定義され、曖昧さが排除される
- 設計ドキュメント間の相互参照と整合性が確保される

## リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| common.md 変更による7ロールへの意図しない影響 | 高 | 既存セクション番号を維持。新規セクションのみ追加 |
| 設計書の20修正ポイントの解釈ずれ | 中 | 設計書の原文をそのまま反映。解釈が必要な場合は設計書の表現を優先 |
| ディスパッチャースキルの分類精度 | 中 | 「該当なし」ケースの処理を明確に定義。確認プロンプトで人間に追加情報を要求 |

## 壁打ちの背景

1. **ディスパッチャー実装方式**: Claude Code スキル / サブエージェント / CLAUDE.md 組み込みの3択を検討し、**Claude Code スキル**を選択。理由: `/dispatcher` でユーザーが明示的に起動可能、description による自動判定も可能、コンテキストコストが低い（オンデマンド読み込み）
2. **dev_manager.md 更新方針**: 全面リライト / 差分更新の2択を検討し、**差分更新**を選択。理由: 現在のファイルは探索施策で作成済みで設計書とほぼ整合しており、変更点はエントリーポイント（外部システム→ディスパッチャー）と5シナリオ参照の追加に限定される
3. **テスト実行コマンド**: 本施策のスコープに含めるか検討し、**スコープ外**とした。理由: テスト環境の確定は本施策の本質ではなく、別途調査が必要

## 備考・設計パターン

参照設計書:
- `docs/design/dev-workflow-overview.md` — ロール構成、TDD戦略、起動パターン
- `docs/design/dev-workflow-detail.md` — 20修正提案（§5.1）、dev_manager要件（§5.2）、common.md修正案（§5.3）
- `docs/design/session-flow-foundations.md` — ライフサイクル、ディスパッチャー、エントリーポイント
- `docs/design/session-flow-scenarios.md` — 5シナリオ詳細
- `docs/design/session-flow-advanced.md` — ハイブリッドレビュー、引き継ぎ、エラー回復、デザインデルタ

---
**起票者**: L1
**起票日**: 2026-03-02
**ステータス**: 実施中
