# 改善施策提案: git worktree によるClaude並列開発の標準化検討

## 背景・課題

Claude Code の Task ツールには `isolation: "worktree"` オプションがあり、サブエージェントをリポジトリの一時的な git worktree 上で実行できる。これにより本流ブランチとは完全に分離された環境で変更を行い、レビュー後にマージする運用が可能になる。

現状の課題:

1. **worktree 活用パターンが未定義**: どのようなタスクで worktree を使うべきか、使わないべきかの判断基準がない
2. **並列開発時の分離レベルが不明確**: 現在の L1/L2 アーキテクチャでは L2 を Task ツールで順次起動しているが、worktree を使えば安全に並列化できる可能性がある
3. **既存ロックベースパターンとの棲み分け**: 参考 PoC（`refs/ai-driven-development-poc/`）ではテキストファイルベースのロック方式を採用しているが、worktree であればそもそもファイル競合が発生しないため、より簡潔な運用が可能な場面がある

## 目標

- git worktree を使った隔離開発の**標準パターンをガイドライン文書として整理**する
- どのような場面で worktree を使うべきか・使わないべきかの**判断基準を明確化**する
- 現在のL1/L2ワークフローとの関係を整理し、将来の並列化拡張の道筋を示す

## スコープ

### やること
- Claude Code の `isolation: "worktree"` 機能の仕様・制約を調査する
- worktree を使う場面と使わない場面の判断基準をまとめる
- ガイドライン文書（`docs/` 配下）を作成する
- 参考 PoC（`refs/ai-driven-development-poc/`）のロックベース方式との比較分析を行う
- 協調プロトコル整備施策（`initiatives/coordination-protocol/`）との接続点を整理する

### やらないこと
- CLAUDE.md や `.claude/rules/*.md` への組み込み（調査・ガイドライン作成までがスコープ）
- L1/L2 ワークフローの実際の変更
- worktree を使った並列実行の実装・スクリプト作成
- 参考 PoC のロックベース方式の導入

## 期待される効果

- worktree の活用判断が属人化せず、チーム全体で標準的な判断ができるようになる
- 将来の並列開発拡張時の設計指針として参照できるガイドラインが整う
- ロックベース方式との使い分けが明確になり、過剰・過少な分離の回避につながる

## リスク

| リスク | 影響度 | 対策 |
|--------|--------|------|
| Claude Code の worktree 機能の仕様が変更される可能性 | 低 | ガイドラインにバージョン依存の前提を明記し、変更時に更新する |
| 調査結果が「worktree は現状の運用では不要」となる可能性 | 低 | その判断自体が有用な成果物。判断根拠をガイドラインに記録する |
| ガイドライン文書が形骸化するリスク | 低 | 次期の協調プロトコル施策で実運用に組み込む際にガイドラインを参照・更新する |

## 壁打ちの背景

壁打ちフェーズで以下の意思決定を行った。

- **成果物の深さ**: 調査・ガイドライン文書の作成まで。CLAUDE.md やルールファイルへの組み込みは行わない（将来の施策で検討）
- **施策の独立性**: 協調プロトコル整備とは別の initiative として進める。worktree はインフラ的な隔離メカニズム、協調プロトコルはその上の運用ルールであり、レイヤーが異なるため
- **協調プロトコルとの接続**: ガイドライン内で協調プロトコル施策との関係を整理し、接続点を明記する

## 備考・設計パターン

本施策は調査・文書化が主であり、コード変更を伴わない。
参考 PoC の知見を活用しつつ、Claude Code の worktree 機能に特化した観点でガイドラインを作成する。

---
**起票者**: L1
**起票日**: 2026-02-25
**ステータス**: 起票
