# 改善施策提案: セッション運用フロー設計書の分割

## 背景・課題

施策「シナリオ別セッション運用フロー設計」で作成した `docs/design/session-operation-flow.md` が **1,559行** と長大。将来的に `.claude/` 配下のルールファイル・スキルとして実装する予定だが、1ファイルのままではマッピングが困難。

### 現在の設計ドキュメント群

| ファイル | 行数 | 状態 |
|---------|------|------|
| `dev-workflow-overview.md` | 242 | 適正 |
| `dev-workflow-detail.md` | 765 | 許容範囲 |
| `session-operation-flow.md` | 1,559 | **分割推奨** |

### 自然な分割ポイント

| グループ | セクション | 行数 | 内容 |
|---------|-----------|------|------|
| **基盤** | §1-4 | ~397 | 概要、ライフサイクルモデル、ディスパッチャー/ルーター、人間エントリーポイント |
| **シナリオ** | §5-9 | ~649 | 5シナリオの詳細フロー（各シナリオ独立度 75-90%） |
| **横断・統合** | §10-13 | ~511 | ハイブリッドレビュー、横断的関心事、統合マッピング、まとめ |

## 目標

- `session-operation-flow.md` を3つの独立ファイルに分割し、元ファイルをハブドキュメント化する
- 各分割ファイルが **350-650行** に収まること
- 全ての内部相互参照・外部参照が正しく維持されること

## スコープ

### やること

- §1-4 を `session-flow-foundations.md` に切り出し
- §5-9 を `session-flow-scenarios.md` に切り出し
- §10-13 を `session-flow-advanced.md` に切り出し
- 元の `session-operation-flow.md` をハブドキュメント化（概要 + 各ファイルへのリンク）
- 分割ファイル間の§X記法をマークダウンリンク形式に変換
- 既存ドキュメント（`dev-workflow-overview.md`, `dev-workflow-detail.md`）の参照パスを更新

### やらないこと

- 設計内容の変更・追記（純粋な分割のみ）
- セクション番号のリナンバリング（元のセクション番号を維持）
- 他の設計ドキュメントの分割

## 期待される効果

- 各ファイルが **350-650行** に収まり、読了・レビュー・メンテナンスのコストが低下
- `.claude/` 実装時の設計→実装マッピングが 1:1 で明確になる
- 変更影響範囲が限定され、PR レビューが容易に

### `.claude/` 実装との対応関係

| 設計グループ | → 将来の実装先 |
|------------|-------------|
| 基盤（ライフサイクル・ディスパッチャー） | `.claude/rules/` のセッション管理ルール、CLAUDE.md |
| シナリオ別フロー | `.claude/skills/` の各シナリオ用スキル |
| 横断的関心事 | `.claude/rules/` の共通ルール、`roles/_base/common.md` |

## リスク

| リスク | 影響度 | 対策 |
|--------|--------|------|
| 内部相互参照（§X記法）の切れ | 中 | 分割後にファイル間リンク形式に変換し、全参照を検証 |
| 外部参照の更新漏れ | 中 | grep で全参照箇所を特定してから作業 |
| 分割ファイル間のコンテキスト喪失 | 低 | 各ファイル冒頭に「本ドキュメントの位置づけ」を追加し、ハブで全体像を維持 |

## 壁打ちの背景

- **相互参照の扱い**: 同一ファイル内の§X記法はそのまま維持し、他ファイルへの参照はマークダウンリンク形式（例: `[§2.3](session-flow-foundations.md#23-設計原則)`）に変換する方針で合意
- **施策ディレクトリ名**: `split-session-flow-design`（英語kebab-case）で合意
- **依存関係**: 前提施策「施策管理連携の除去」は完了済み。本施策の完了が「セッション横断の作業規律設計」の前提となる
- **セクション番号**: 元のセクション番号を維持し、リナンバリングは行わない。分割ファイルごとに番号を振り直すと既存の§X参照が全て壊れるため

## 備考・設計パターン

### 分割後のファイル構成

```
docs/design/
├── session-operation-flow.md           → 概要 + 各ドキュメントへのリンク（ハブ）~50-80行
├── session-flow-foundations.md         → §1-4（基盤）~397行
├── session-flow-scenarios.md           → §5-9（シナリオ）~649行
└── session-flow-advanced.md            → §10-13（横断・統合）~511行
```

---
**起票者**: L1
**起票日**: 2026-03-01
**ステータス**: 承認済
