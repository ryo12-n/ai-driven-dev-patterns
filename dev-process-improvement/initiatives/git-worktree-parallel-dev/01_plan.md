# 実施計画: git worktree による Claude 並列開発の標準化

## フェーズ構成

| フェーズ | 内容 | 成功基準 |
|---------|------|----------|
| 1 | 現状分析・並列化ポイント特定・設計・実装 | 成功基準 1〜5 をすべて満たす |

> 単一フェーズ構成とする。前回施策で調査・ガイドラインは完了済みのため、今回は分析〜実装を一気通貫で実施する。

## 作業概要

### Step 1: 並列化ポイントの分析
- 既存の開発ワークフロー設計書（`docs/design/`）を精読し、ロール間の依存関係を整理
- 並列実行可能なロールの組み合わせを特定（例: feature_builder + test_writer、reviewer の独立実行）
- 各シナリオ（5つ）ごとに並列化パターンを分析

### Step 2: 設計・ルール定義
- dev_manager ロールの並列オーケストレーションロジックを設計
- セッションディレクトリ構造の並列対応設計
- マージ戦略・コンフリクト解決手順の定義
- `.claude/rules/` に並列開発ルールファイルを作成

### Step 3: 実装
- `.claude/agents/` にworktree 対応エージェント定義を作成（必要な場合）
- `roles/dev_manager.md` の更新（並列起動の判断基準・手順を追加）
- `roles/_base/common.md` の更新（worktree 環境での共通ルール追加）
- `sessions/_template/` の並列対応更新
- `.claude/settings.json` の更新（必要な権限設定等）
- 既存ガイドライン（`docs/git-worktree-guideline.md`）の更新

### Step 4: 整合性確認
- 既存の設計書（`docs/design/`）との整合性を確認
- 変更が既存ワークフローの逐次実行パスに影響しないことを確認
- 全成果物のセルフレビュー

## 成功基準（全体）

1. dev_manager ロール定義に並列オーケストレーションロジックが含まれ、worktree を使った複数ロール並列起動の判断基準と手順が明文化されている
2. 並列実行対象のロール（最低2つ以上）が特定され、必要な `isolation: worktree` 設定が適用されている
3. セッションディレクトリ構造（`sessions/_template/`）が並列実行に対応し、複数ロールの成果物を正しく管理できる
4. マージ戦略とコンフリクト解決手順が `.claude/rules/` に明文化されている
5. 既存の逐次実行ワークフローとの後方互換性が維持されている（並列化はオプトイン方式）

## リソース・前提条件

- 前回施策のガイドライン（`docs/git-worktree-guideline.md`）を基盤とする
- Claude Code 2026年2月〜3月時点の `isolation: "worktree"` 仕様に基づく
- 既存の開発ワークフロー設計書（`docs/design/` 6ファイル）を正として扱う
- 既存のロール定義（`roles/` 8ファイル + `_base/`）を正として扱う

## リスクと対策

| リスク | 発生確率 | 影響 | 対策 |
|--------|---------|------|------|
| 既存設計書との整合性が取れない変更が必要になる | 中 | 高 | 変更は最小限に留め、既存設計の拡張として実装する。設計書の修正が必要な場合は影響範囲を明記 |
| 並列実行のオーバーヘッドが利点を上回るケースがある | 低 | 中 | 判断基準にフォールバック条件（逐次実行への切り替え）を含める |
| worktree 内でのテスト実行が競合する | 低 | 中 | テスト実行はマージ後に統合テストとして実施するフローを定義 |

---
**作成者**: L1
**作成日**: 2026-03-02
**最終更新**: 2026-03-02
