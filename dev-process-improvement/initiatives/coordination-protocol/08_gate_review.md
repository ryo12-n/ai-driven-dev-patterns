# フェーズゲート判定: 協調プロトコル整備（commit/lock/test）

## 判定対象フェーズ

フェーズ1（調査・プロトコル設計・ガイドライン文書作成）の完了判定

## 判定材料
- 作業レポート: `04_work_report.md`
- 評価レポート: `06_eval_report.md`
- 課題一覧: `07_issues.md`
- ガイドライン文書: `docs/coordination-protocol-guideline.md`

## 判定

| 判定項目 | 基準 | 実績 | 合否 |
|---------|------|------|------|
| SC-1: commit プロトコル | タイミング・メッセージ規約・コンフリクト解消手順が定義されている | セクション2に5項目（タイミング・規約・ブランチ戦略・コンフリクト解消・worktree差異）が定義済み | ✅ |
| SC-2: lock プロトコル | 排他制御の仕組み・対象リソースの粒度・デッドロック回避策が定義されている | セクション3に3層ロック方式（ファイル所有権→worktree隔離→テキストファイルロック）・ファイル単位粒度・デッドロック回避4策が定義済み | ✅ |
| SC-3: test プロトコル | テスト実行の順序・範囲・失敗時の振る舞いが定義されている | セクション4にタイミング・範囲・並列排他・失敗時の振る舞い・2段階テスト採用が定義済み。文書中心リポジトリ向けに再定義 | ✅ |
| SC-4: PoC 分析とカスタマイズ | 参考 PoC の設計が分析され本リポジトリ向けにカスタマイズされている | セクション1.4に分析サマリー。tmux並列→Task ツール、コード中心→文書中心の適応が適切 | ✅ |
| SC-5: worktree ガイドラインとの整合 | git worktree 施策のガイドラインとの整合が確認されている | セクション7にレイヤー分離・接続点3項目・ステージ対応表が記載。前提条件として文書冒頭にも明記 | ✅ |

## 未解決課題の影響評価

| 課題ID | 影響度 | 次フェーズへの影響 | 対応方針 |
|--------|--------|------------------|---------|
| EVL-001 | 低 | なし | 施策外コミット形式はガイドライン改訂時に追加 |
| EVL-002 | 低 | 並列化移行時に要対応 | ステージ2準備施策でテスト結果集約方法を定義 |
| EVL-003 (ISS-014) | 中 | ステップ1の即時適用に関わる | コミットメッセージ規約のルール反映を別施策として起票を推奨 |
| EVL-004 | 低 | なし（ステージ3の将来課題） | ステージ3移行時にTask ツール環境でのロック代替手段を検討 |

## 総合判定

- [x] **通過**: 次フェーズに進む
- [ ] **条件付き通過**: 以下の条件を満たした上で次フェーズに進む
- [ ] **差し戻し**: 以下の理由で現フェーズをやり直す

## 判定理由

1. **成功基準5項目すべて達成**: 評価レポートで全項目が達成と判定されている
2. **課題の影響は限定的**: EVL-001〜EVL-004 はいずれも現フェーズの品質を阻害するレベルではない。EVL-003（ISS-014）は中程度の影響だが、ルール反映は本施策のスコープ外（ガイドライン作成まで）として明確に定義されており、別施策で対応すべき内容
3. **3層ロック設計が秀逸**: 既存のファイル所有権ルール（層1）を維持しつつ、worktree（層2）→明示的ロック（層3）へと段階的に拡張する設計は、運用の複雑さを最小限に抑えつつ将来の並列化に対応できる
4. **worktree ガイドラインとの接続が確保**: セクション7で2つのガイドラインのレイヤー関係が明確に整理されている

L1 判断: 評価レポートは「条件付き」としているが、条件として挙げられた4点はいずれも本施策のスコープ（ガイドライン作成）外の改善事項であり、次施策への引き継ぎ事項として管理すれば十分。よって「通過」と判定する。

## 計画修正

なし。本施策は調査・ガイドライン作成の単一フェーズ施策であり、フェーズ2以降は不要。

---

## 横展開・次施策への引き継ぎ事項

### 必須把握事項（次回施策着手前に確認すること）

| # | 知見・注意事項 | 詳細 |
|---|--------------|------|
| 1 | 3層ロック方式の段階的適用 | 層1（ファイル所有権）→ 層2（worktree）→ 層3（テキストファイルロック）の順で段階的に適用。現在は層1のみで十分 |
| 2 | コミットメッセージ規約は即時適用可能 | `[session-type] initiative: summary` 形式。ただしルールファイルへの反映は別施策が必要（ISS-014） |
| 3 | 施策外コミットのカバー不足 (EVL-001) | トリアージ・upstream同期等の施策外作業のコミットメッセージ規約が未定義。ルール反映施策で合わせて対応すること |
| 4 | 層3ロックのTask ツール環境での制約 (EVL-004) | PoC の「push成功=ロック取得」はTask ツール環境では適用不可。ステージ3移行時に代替手段の検討が必要 |
| 5 | テスト結果集約方法の未定義 (EVL-002) | 並列実行（ステージ2〜3）時に各worktreeのテスト結果をL1がどう収集・判断するかが未定義。ステージ2準備施策で対応すること |

### 次施策候補への提案

| 提案 | 背景 |
|------|------|
| コミットメッセージ規約のルール反映施策 (ISS-014) | ステップ1は即時適用可能だが、ルールファイルに反映しないと形骸化リスクあり |
| テストスクリプト整備施策 | ステップ2（`ci/run_fast.sh`・`ci/run_full.sh`）の実装。文書中心リポジトリ向けテスト内容は本ガイドラインで定義済み |
| Agent Teams 機能の調査施策 (ISS-013) | worktree + Agent Teams の組み合わせパターンの検討。両ガイドラインで将来の検討事項として言及 |

---
**判定者**: L1
**判定日**: 2026-02-25
