# 開発プロセス改善ワークフロー

> **このファイルの位置づけ**
> `.claude/rules/*.md`（AIルールファイル）が正の情報源（Source of Truth）。
> このファイルはルールファイルの内容を人間が理解するための可視化・要約です。
> ルールを変更した場合は、このファイルも合わせて更新してください。

## イニシアティブセッション フロー

```
[L1 マネージャー]
  フェーズ0: 壁打ち（理解のサマリー・不明点をユーザーに確認）
    → 調査・方針決定 → 提案(00_proposal.md) → 計画(01_plan.md) → タスク作成(02_tasks.md)
    ※ 02_tasks.md には CSV 転記の固定タスクを必ず含める（後述）
                                                                    ↓
[L2 ワーカー（実施）] ← L1 が Task ツールでサブエージェントとして起動
  壁打ちフェーズ → 03_work_log.md に実施計画サマリを記載 → タスク実施 → 作業記録を追記
  → 04_work_report.md を作成
  ※ 課題発見時: 07_issues.md に一時メモ → 施策完了時に CSV へ転記
                                                                    ↓
  L1: worker 成果物を確認（タスク完了状態・CSV転記状態）→ 品質不十分なら差し戻し
                                                                    ↓
[L2 ワーカー（評価）] ← L1 が Task ツールでサブエージェントとして起動（worker 完了後に順次起動）
  壁打ちフェーズ → 05_eval_plan.md → 評価実施 → 06_eval_report.md
  → 課題があれば 07_issues.md に追記 → CSV へ転記
                                                                    ↓
[L1 マネージャー]
  04・06・07 を確認 → 08_gate_review.md にゲート判定を記入
    → 通過     : 次フェーズのタスクを 02_tasks.md に追記
    → 条件付き : 条件対応タスクを追記 → L2 に差し戻し
    → 差し戻し : 計画修正 → 02_tasks.md 修正 → L2 に差し戻し
```

### 壁打ちフェーズ（フェーズ0）

各セッション（L1・L2 共通）は作業着手前に壁打ちフェーズを実施する。

- **L1**: `00_proposal.md` 作成前に理解のサマリー・不明点を提示し、ユーザーに確認する
- **L2-worker**: `03_work_log.md` 冒頭にサマリー・前提条件チェック・不明点を記録。不明点があれば停止してL1の確認を待つ
- **L2-evaluator**: `05_eval_plan.md` 冒頭に同様のフォーマットで記録

### L2 サブエージェントの起動

L1 は L2 を **Task ツール（サブエージェント）** として順番に起動する。L2-worker が完了してから L2-evaluator を起動すること（並列起動しない）。

起動時に渡す情報: 役割とルールファイル、施策パス、タスク範囲、完了の定義

### 固定タスク（02_tasks.md に必ず含める）

| 対象 | やること | 完了条件 |
|------|---------|---------|
| L2-worker（最終タスク） | `07_issues.md` の未転記課題を CSV へ転記 | 全課題に `[転記済 ISS-XXX]` or 「転記不要」が付いている |
| L2-evaluator（最終タスク） | 評価中発見の課題を `07_issues.md` 起票 → CSV 転記 | 同上 |

## トリアージセッション フロー

```
1. 事前調査      → triage/YYYYMMDD/00_pre_investigation.md を埋める
                   【必須走査項目】
                   ・inbox / backlog / CSV / initiative の現状把握
                   ・docs/collab-log.md の未蒸留エントリ確認
                   ・.claude/rules/*.md と docs/workflow.md の整合性確認（必須）
                     → 軽微な乖離はそのセッション内で修正する
                     → 大きな乖離は CSV に起票して次回以降に対応
                   ・refs/ の孤立エントリ確認（inbox/ref_*.md が存在しないエントリ）
                     → 発見したらユーザーに内容と扱いを確認する
                     → ユーザーの回答をもとに inbox/ref_<名前>.md を新規作成
                        （概要 + 今後の扱い方針: 施策化検討 / 参照のみ保持 / 削除 を記載）
                     → refs/ の本体は削除しない（扱いは別途判断）
2. 実施計画作成  → triage/YYYYMMDD/01_plan.md を作成
                   （今回の重点・走査タスクを決める）
3. 実施          → inbox / backlog / CSV を走査・分類
                   ・完了済み initiative（ゲート通過済み・未アーカイブ）を検出し、
                     クローズチェックリスト検証後にアーカイブ対象としてレポートに記載
4. 作業履歴      → triage/YYYYMMDD/02_work_log.md に記録
5. レポート作成  → triage/YYYYMMDD/03_report.md を作成 → PR として提出
6. ユーザーレビュー
7. backlog 反映  → 承認後に backlog/ へ個別ファイルを作成
8. 後処理        → 処理済み inbox アイテムを削除（git 履歴が証跡）
9. 課題起票      → 課題と確定したものを プロセス改善_課題管理.csv に直接起票
```

> **課題起票の考え方**
> トリアージは「整理・判断するセッション」のため、L2セッションのような一時メモファイル
> （`07_issues.md`）は使わず、CSV に直接起票します。
> まだ判断できない粒度の粗いメモは `02_work_log.md` の「判断・気づき」欄に書いておき、
> 走査完了後に課題と確定したものだけ CSV に起票してください。

---

## ファイルのオーナーシップ

> 記号の凡例: ✏️ 作成・編集可 / 👁️ 読取のみ / ☑️ チェック更新のみ / 📝 判断・代理更新（条件付き）

| ファイル | L1 | L2(実施) | L2(評価) |
|---------|-----|---------|---------|
| 00_proposal.md | ✏️ 作成・編集 | 👁️ 読取 | 👁️ 読取 |
| 01_plan.md | ✏️ 作成・編集 | 👁️ 読取 | 👁️ 読取 |
| 02_tasks.md | ✏️ 作成・編集 | ☑️ チェック更新可 | 👁️ 読取 |
| 03_work_log.md | 👁️ 読取（判断根拠を末尾に追記可）*1 | ✏️ 作成・編集 | 👁️ 読取 |
| 04_work_report.md | 👁️ 読取 | ✏️ 作成・編集 | 👁️ 読取 |
| 05_eval_plan.md | 👁️ 読取 | 👁️ 読取 | ✏️ 作成・編集 |
| 06_eval_report.md | 👁️ 読取 | 👁️ 読取 | ✏️ 作成・編集 |
| 07_issues.md | 📝 転記判断・代理転記（resume 不可時のみ）*2 | ✏️ 一時メモ起票 | ✏️ 一時メモ起票 |
| 08_gate_review.md | ✏️ 作成・編集 | 👁️ 読取 | 👁️ 読取 |
| プロセス改善_課題管理.csv | ✏️ 対応方針確定・タスク化 | ✏️ 転記 | ✏️ 転記 |

*1: L1 の判断根拠（分岐の理由・起動の意思決定）は `03_work_log.md` の末尾に記録する（`l1-manager.md` 参照）。
*2: L1 が `07_issues.md` の CSV 転記を行うのは、L2-worker を resume できない場合（コンテキスト消失・セッション期限切れ等）に限る。通常は L2-worker を resume して転記を依頼する（`l1-manager.md` 参照）。


## 課題管理フロー

### 起票（L2 が行う）
1. 施策実施中に課題・知見・リスクを発見したら `07_issues.md` に一時メモを書く
2. 施策完了時または定期レビュー時に、施策をまたいで再発しうる課題を `プロセス改善_課題管理.csv` へ転記する
3. 転記した項目は `07_issues.md` に `[転記済 ISS-XXX]` を記して削除する

### 対応方針確定・タスク化（L1 が行う）
1. CSV の `ステータス = 起票` の行を確認する
2. 対応するかどうかを判断し、`対応方針_確定` 列と `確定日` 列を埋める
3. タスク化する場合は `ステータス = タスク化済`、`タスク化先` 列に施策名・タスクIDを記入する
4. 対応しない場合は `ステータス = 対応不要` にして `備考` に理由を書く

### CSV の列定義

| 列名 | 説明 | 値の例 |
|------|------|--------|
| ID | ISS-001 から連番 | ISS-001 |
| 起票日 | YYYY-MM-DD | 2026-02-21 |
| カテゴリ | 課題の分類 | ツール / プロセス / ドキュメント / テンプレート |
| 種別 | 課題の性質 | 不具合 / 改善提案 / リスク / 知見 |
| タイトル | 1行のタイトル | - |
| 課題詳細 | 何が起きたか（3行以内推奨） | - |
| 対応方針_案 | 起票時点の案（`[案]` 接頭辞で未確定を明示） | [案] テンプレートに注意書きを追加する |
| ステータス | 対応状況 | 起票 / 方針確定 / タスク化済 / クローズ / 対応不要 |
| 優先度 | 高 / 中 / 低 | 中 |
| 関連施策 | 発生した施策名 | openspec-process-integration |
| タスク化先 | タスクIDや施策名 | - |
| 対応方針_確定 | L1 が確定した対応内容 | - |
| 確定日 | YYYY-MM-DD | - |
| 備考 | 補足コメント | - |
